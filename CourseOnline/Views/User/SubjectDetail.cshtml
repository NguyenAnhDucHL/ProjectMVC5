@using CourseOnline.Models;
@{
    ViewBag.Title = "SubjectDetail";
}
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    Subject subject = ViewBag.subject;
    User teacher = ViewBag.teacher;
    List<LessonModel> lesson = ViewBag.lesson;
}
<link rel="stylesheet" href="~/Assets/customcss/menu.css">
<div class="site-section ftco-subscribe-1 site-blocks-cover pb-4" style="background-image: url('@subject.picture')">
    <div class="container">
        <div class="row align-items-end">
            <div class="col-lg-7">
                <h2 class="mb-0">@subject.subject_name</h2>
                <p>@subject.subject_category</p>
            </div>
        </div>
    </div>
</div>


<div class="custom-breadcrumns border-bottom">
    <div class="container">
        <a href="@Url.Action("Home_User", "Home")">Home</a>
        <span class="mx-3 icon-keyboard_arrow_right"></span>
        <a href="@Url.Action("ListSubjects", "Subject")">Subjects</a>
        <span class="mx-3 icon-keyboard_arrow_right"></span>
        <span class="current">@subject.subject_name</span>
    </div>
</div>

<div class="site-section">
    <div class="container">
        <div class="row">
            <div class="col-md-6 mb-4">
                <p>
                    <img src="@(subject.picture == null ? "" : Url.Content(@subject.picture))" alt="Image" class="img-fluid">
                </p>
            </div>
            <div class="col-lg-5 ml-auto align-self-center">
                <h2 class="section-title-underline mb-5">
                    <span>Subject Details</span>
                </h2>
                @{ if (ViewBag.teacher != null)
                    {
                        <p>
                            <strong class="text-black d-block">Teacher:</strong>
                            @teacher.user_fullname
                        </p>
                        <p>
                            <strong class="text-black d-block">Teacher' Email:</strong>
                            @teacher.user_email
                        </p>
                        <p>
                            <strong class="text-black d-block">Teacher' Mobile:</strong>
                            @teacher.use_mobile
                        </p>
                    }
                }
                <p><strong class="text-black d-block">Summary:</strong> @subject.subject_brief_info</p>
                <p>
                    @if (Session["Name"] == null)
                    {
                        <a href="#" onclick="DisplayError()" class="btn btn-primary rounded-0 btn-lg px-5">Registration</a>
                    }
                    else
                    {
                        <a href="#" onclick="Registration()" class="btn btn-primary rounded-0 btn-lg px-5">Registration</a>
                    }
                </p>
            </div>
        </div>
        <h2 class="section-title-underline mb-5">
            <span>Objective Course</span>
        </h2>
        @subject.ObjectiveCourse
        <h2 class="section-title-underline">
            <span>Course Content</span>
        </h2>
        <div class="col-md-10 ">
            <div class="well no-padding">
                <div>
                    <ul class="nav-list nav-menu-list-style">
                        @foreach (Lesson item in lesson)
                        {
                            int countlesson = 0;
                            <li>
                                @if (item.parent_id == item.lesson_id)
                                {
                                    foreach (Lesson item1 in lesson)
                                    {
                                        if (item1.parent_id != item1.lesson_id && item1.parent_id == item.parent_id)
                                        {
                                            countlesson++;
                                        }
                                    }
                                    <label class="tree-toggle nav-header glyphicon-icon-rpad">
                                        @item.lesson_name :
                                        <span>@countlesson Lectures</span>
                                        <span class="menu-collapsible-icon glyphicon glyphicon-chevron-down"></span>
                                    </label>
                                    foreach (Lesson item1 in lesson)
                                    {
                                        if (item1.parent_id != item1.lesson_id && item1.parent_id == item.parent_id)
                                        {
                                            <ul class=" nav-list tree" style="text-align:left">
                                                <li>@item1.lesson_name</li>
                                            </ul>
                                        }
                                    }
                                }
                            </li>
                            <li class="divider"></li>
                        }
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="MyModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4>Resgistration Course</h4>
                <a href="#" class="close" data-dismiss="modal">&times;</a>
            </div>
            <div class="modal-body">
                <h5>@subject.subject_name</h5>
                <h5>Your Information</h5>
                <form id="form">
                    <fieldset id="SubmitForm">
                        <div class="form-group">
                            <input disabled id="slName" value="@Session["Name"]" />
                        </div>
                        <div class="form-group">
                            <input disabled id="slEmail" value="@Session["Email"]" />
                        </div>
                        <div class="form-group">
                            <input disabled id="slMobile" value="@Session["userMobile"]" />
                        </div>
                        <div class="form-group">
                            <a href="#" class="btn btn-block btn-danger" id="RegistrationCourse">Registration</a>
                        </div>
                    </fieldset>
                </form>
            </div>
        </div>
    </div>
</div>




<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>

    $('.tree-toggle').click(function () {
        $(this).parent().children('ul.tree').toggle(200);
    });
    $(function () {
        $('.tree-toggle').parent().children('ul.tree').toggle(200);
    })

    function DisplayError() {
        errorAlert("You need to login first");
    }

    function Registration() {
        $("#MyModal").modal();
    }

    $("#RegistrationCourse").click(function () {
        $.ajax({
            url: '@Url.Action("SubjectRegistration","Home")',
            type: "POST",
            data: { teacherID: @teacher.user_id, subjectID: @subject.subject_id },
            dataType: "json",
            success: (response) => {
                if (response.success) {
                    successAlert("Registration Success");
                    $("#MyModal").modal('toggle');
                }
                else {
                    errorAlert("Registration Fail");
                }
            },
            error: (response) => { errorAlert("Opps!! Something wrong!") }
        });
    });
</script>
